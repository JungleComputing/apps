<project
    name="repmi-app"
    default="build"
    basedir=".">

    <import file="${ibis}/build-properties.xml"/>
    <import file="${ibis}/build-iogen.xml"/>
    <import file="${ibis}/build-rmic.xml"/>
    <import file="${ibis}/build-native.xml"/>

    <target name="init" depends="property-init">
	<tstamp/>
	<mkdir dir="${build}"/>
	<!--
	<echo message="os.name = ${os.name} os.arch = ${os.arch}"/>
	<echo message="user.name = ${user.name} user.dir = ${user.dir}"/>
	<echo message="java.ext.dirs = ${java.ext.dirs}"/>
	-->
    </target>

    <target name="compile"
	    depends="init,property-init">
        <property name="class-path" refid="default.classpath"/>
	<echo   message="class path ${class-path}"/>

	<javac  destdir="${build}"
		debug="${java.debug.value}"
		srcdir=".">
	    <classpath refid="default.classpath"/>
	    <include name="**/*.java"/>
	</javac>
    </target>

    <target name="build"
	    depends="init"
	    description="Compile RMI application for Ibis RMI">
	<antcall inheritAll="true" inheritRefs="true" target="compile"/>
	<antcall inheritRefs="true" target="rmic"/>
	<antcall inheritRefs="true" target="iogen"/>
    </target>

    <target name="build-sun"
	    depends="init"
	    description="Compile RMI application for Sun RMI">
	<antcall inheritAll="true" inheritRefs="true" target="compile"/>
	<antcall inheritRefs="true" target="rmic-sun"/>
    </target>

    <target name="build-karmi"
	    depends="init"
	    description="Compile RMI application for KaRMI">
	<replace
		dir="."
		token="java.rmi."
		value="uka.karmi.rmi."/>
	<replace
		dir="."
		token="uka.karmi.rmi.RMISecurityManager"
		value="java.rmi.RMISecurityManager"/>

	<path id="extra-classpath">
	    <pathelement path="${karmi}/karmi.jar"/>
	</path>
	<antcall inheritAll="false" inheritRefs="false" target="compile">
	    <reference refid="extra-classpath"/>
	</antcall>
	<antcall inheritAll="false" inheritRefs="false" target="rmic-karmi">
	    <reference refid="extra-classpath"/>
	</antcall>

	<replace
		dir="."
		token="uka.karmi.rmi"
		value="java.rmi"/>
    </target>

    <target name="clean">
	<delete dir="${build}"/>
    </target>

</project>
