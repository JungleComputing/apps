#!/bin/bash

# reserve="-reserve 715713"
timeout="-t 10:0"

n=10

# sers="ibis sun"
sers="ibis"

# Byte serialization can only handle bytes

ibises="panda net.gm"
# ibises="panda"

if false ; then
    ser="byte"
    data="-byte"
    for ibis in $ibises ; do
	for (( i = 0; i < $n; i++ )) ; do
	    sh run-rpc $ibis $ser 10000 100000 "$reserve $timeout" $data
	done
    done
fi

if true ; then
    for ibis in $ibises ; do
	for (( i = 0; i < $n; i++ )) ; do
	    for ser in $sers ; do
if false; then
		for data in "-byte" "-int" "-double" ; do
		    sh run-rpc $ibis $ser 10000 100000 "$reserve $timeout" $data
		done
fi
		sh run-rpc $ibis $ser 10000 1023 "$reserve $timeout" "-tree -one-way"
	    done
	done
    done
fi

# ibises="tcp net.bytes.gen.tcp_blk"
ibises="net.bytes.gen.tcp_blk"

# Byte serialization can only handle bytes

if false ; then
    ser="byte"
    data="-byte"
    for ibis in $ibises ; do
	for (( i = 0; i < $n; i++ )) ; do
	    for y in 0 1 2 3 4 ; do
		sh run-rpc $ibis $ser 2000 100000 "$reserve $timeout" $data
	    done
	done
    done
fi

if true ; then
    for ibis in $ibises ; do
	for (( i = 0; i < $n; i++ )) ; do
	    for (( j = 0; j < 5; j++ )) ; do
		for ser in $sers ; do
		    for data in "-byte" "-int" "-double" ; do
			sh run-rpc $ibis $ser 2000 100000 "$reserve $timeout" $data
		    done
		    sh run-rpc $ibis $ser 2000 1023 "$reserve $timeout" "-tree"
		done
	    done
	done
    done
fi
