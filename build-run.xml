<project
    name="run"
    default="run1"
    basedir=".">

    <description>
	Ibis application run target.

	Require prior definition of properties:
	ibis			location of ibis root

	Targets:

	run1	run the application as a parallel program,
		with a single instance, using TCP ibis.
		Set parameter:
		runjob		main class name and arguments

	run2	run the application as a parallel program,
		with two instances, using TCP ibis.
		Set parameter:
		runjob		main class name and arguments

	runseq	run the application as a sequential program.
		Set parameter:
		runjob		main class name and arguments

    </description>

    <target name="run2">
	<exec dir="${basedir}"
	      executable="${ibis}/bin/ibis_nameserver"
	      vmlauncher="false"
	      spawn="true">
	      <arg line="-single -port 4567"/>
	</exec>
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      vmlauncher="false"
	      spawn="true">
	      <arg line="-sleep 3 -ns localhost:4567 -nhosts 2 -Dibis.name=tcp ${runjob}"/>
	</exec>
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      timeout="100000"
	      failonerror="true"
	      vmlauncher="false">
	      <arg line="-sleep 2 -ns localhost:4567 -nhosts 2 -Dibis.name=tcp ${runjob}"/>
	</exec>
    </target>

    <target name="run1">
	<exec dir="${basedir}"
	      executable="${ibis}/bin/ibis_nameserver"
	      vmlauncher="false"
	      spawn="true">
	      <arg line="-single -port 4567"/>
	</exec>
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      timeout="100000"
	      failonerror="true"
	      vmlauncher="false">
	      <arg line="-sleep 2 -ns localhost:4567 -nhosts 1 -Dibis.name=tcp ${runjob}"/>
	</exec>
    </target>

    <target name="runseq">
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      timeout="100000"
	      failonerror="true"
	      vmlauncher="false">
	      <arg line="${runjob}"/>
	</exec>
    </target>

    <!-- Default test target, for if the application does not have one.
	 Causes a build.
    -->
    <target name="test"
	    depends="build">
    </target>

</project>
