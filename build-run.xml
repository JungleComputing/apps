<project
    name="run"
    default="run1"
    basedir=".">

    <description>
	Ibis application run target.

	Require prior definition of properties:
	ibis			location of ibis root

	Targets:

	run1	run the application as a parallel program,
		with a single instance, using TCP ibis.
		Set parameter:
		runjob		main class name and arguments
		java-args	flags for java
		run-ibis-args	flags for run-ibis

	run2	run the application as a parallel program,
		with two instances, using TCP ibis.
		Set parameter:
		runjob		main class name and arguments
		java-args	flags for java
		run-ibis-args	flags for run-ibis

	runseq	run the application as a sequential program.
		Set parameter:
		runjob		main class name and arguments
		java-args	flags for java
		run-ibis-args	flags for run-ibis

    </description>

    <property name="run-ibis-args" value=""/>
    <property name="java-args" value=""/>

    <target name="run2">
	<exec dir="${basedir}"
	      executable="${ibis}/bin/ibis_nameserver"
	      vmlauncher="false"
	      spawn="true">
	      <arg line="-single -port 4567"/>
	</exec>
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      vmlauncher="false"
	      spawn="true">
	      <arg line="-ns localhost:4567 -nhosts 2 ${run-ibis-args} -Dibis.name=tcp ${java-args} ibis.util.Postpone 3 ${runjob}"/>
	</exec>
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      timeout="500000"
	      failonerror="true"
	      vmlauncher="false">
	      <arg line="-ns localhost:4567 -nhosts 2 ${run-ibis-args} -Dibis.name=tcp ${java-args} ibis.util.Postpone 2 ${runjob}"/>
	</exec>
    </target>

    <target name="run1">
	<exec dir="${basedir}"
	      executable="${ibis}/bin/ibis_nameserver"
	      vmlauncher="false"
	      spawn="true">
	      <arg line="-single -port 4567"/>
	</exec>
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      timeout="500000"
	      failonerror="true"
	      vmlauncher="false">
	      <arg line="-ns localhost:4567 -nhosts 1 ${run-ibis-args} -Dibis.name=tcp ${java-args} ibis.util.Postpone 2 ${runjob}"/>
	</exec>
    </target>

    <target name="runseq">
	<exec dir="${basedir}"
	      executable="${ibis}/bin/run-ibis"
	      timeout="500000"
	      failonerror="true"
	      vmlauncher="false">
	      <arg line="${run-ibis-args} -- ${java-args} ${runjob}"/>
	</exec>
    </target>

    <!-- Default test target, for if the application does not have one.
	 Causes a build.
    -->
    <target name="test"
	    depends="build">
    </target>

</project>
